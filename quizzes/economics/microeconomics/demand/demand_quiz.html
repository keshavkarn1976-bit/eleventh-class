<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demand Chapter Quiz</title>
    
    <link rel="stylesheet" href="./quiz_styles.css"> 

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script> 

    <script src="./js/config.js"></script> 

    <script>
        // Check if credentials are now loaded
        const configError = document.getElementById('config-error');

        if (typeof window.SUPABASE_URL === 'undefined' || typeof window.SUPABASE_ANON_KEY === 'undefined') {
            // Check if the DOM element exists before trying to read 'style' (fixes TypeError)
            if (configError) {
                configError.style.display = 'block';
            }
            console.error("Configuration failed: Supabase keys are missing or config.js failed to load.");
        } else {
            // Supabase initialization (assuming this is your initialization code)
            const supabase = supabase.createClient(
                window.SUPABASE_URL,
                window.SUPABASE_ANON_KEY
            );
            
            console.log("Supabase client initialized successfully. Attempting to fetch quiz data.");
            
            // Call the function to fetch quiz data
            // This function is defined below, ensuring it runs only after Supabase is initialized
            fetchQuizData(supabase); 
        }
        
        // Function to fetch and display quiz data
        async function fetchQuizData(supabaseClient) {
            const quizContainer = document.getElementById('quiz-container');
            
            // Example Query - REPLACE 'quiz_questions' with your ACTUAL Supabase table name
            // If the table name is correct, the RLS policy is the next failure point.
            const { data: quizData, error } = await supabaseClient
                .from('quiz_questions') 
                .select('*');

            if (error) {
                console.error('Supabase Query Error:', error);
                if (quizContainer) {
                    quizContainer.innerHTML = `<p class="error-message">Error: Could not retrieve questions. Check console for RLS or network errors!</p>`;
                }
                return;
            }

            if (quizData && quizData.length > 0) {
                console.log('Quiz data loaded successfully!', quizData);
                // SUCCESS: Now, insert the actual quiz rendering code here
                if (quizContainer) {
                     quizContainer.innerHTML = `<p class="text-green-600 font-bold">SUCCESS! Loaded ${quizData.length} questions. Now insert quiz rendering logic.</p>`;
                }
            } else {
                // This means the table is empty or RLS is blocking the query (401/403)
                if (quizContainer) {
                    quizContainer.innerHTML = `<p class="error-message">No questions found. Check your table name and the Supabase Row Level Security (RLS) policy.</p>`;
                }
            }
        }
        
    </script>
    
    <style>
        /* Add some basic styles here if not using an external CSS file */
        body { font-family: sans-serif; padding: 20px; background-color: #f8f8f8; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1a3e6a; border-bottom: 2px solid #1a3e6a; padding-bottom: 10px; margin-bottom: 20px; }
        .error-message { color: #dc2626; border: 1px solid #dc2626; padding: 15px; background: #fee2e2; border-radius: 4px; }
        .text-green-600 { color: #059669; }
        .font-bold { font-weight: 700; }
    </style>
</head>
<body>

    <div class="container">
        <h1>CBSE Class 11 Microeconomics: Demand Quiz</h1>
        
        <div id="quiz-container">
            <p>Loading quiz questions from Supabase...</p>
        </div>

        <div id="config-error" class="error-message" style="display:none;">
            Configuration Error ðŸ›‘<br>Quiz failed to load because Supabase credentials are missing or the 'config.js' file could not be found.
        </div>
    </div>

</body>
</html>
