<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demand Chapter Quiz</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script> 

    <script src="/eleventh-class/js/config.js"></script> 

    <script>
        // Check if credentials are now loaded
        const configError = document.getElementById('config-error');

        if (typeof window.SUPABASE_URL === 'undefined' || typeof window.SUPABASE_ANON_KEY === 'undefined') {
            // Configuration failed (config.js likely still has a path/casing error)
            if (configError) {
                configError.style.display = 'block';
            }
            console.error("Configuration failed: The absolute path /eleventh-class/js/config.js failed. Please check file capitalization.");
        } else {
            // FIX: Use 'supabaseClient' variable to avoid the ReferenceError conflict.
            const supabaseClient = supabase.createClient(
                window.SUPABASE_URL,
                window.SUPABASE_ANON_KEY
            );
            
            console.log("Supabase client initialized successfully. Attempting to fetch quiz data.");
            
            // Pass the initialized client to the fetch function
            fetchQuizData(supabaseClient); 
        }
        
        // Function to fetch and display quiz data
        async function fetchQuizData(supabaseClient) {
            const quizContainer = document.getElementById('quiz-container');
            
            // ‚ö†Ô∏è IMPORTANT: REPLACE 'quiz_questions' with your ACTUAL Supabase table name
            const { data: quizData, error } = await supabaseClient
                .from('quiz_questions') 
                .select('*');

            if (error) {
                console.error('Supabase Query Error:', error);
                // Displays query error details on the page
                if (quizContainer) {
                    quizContainer.innerHTML = `<p class="error-message">Query Error: ${error.message}. Check browser console for **Row Level Security (RLS)** policy errors!</p>`;
                }
                return;
            }

            if (quizData && quizData.length > 0) {
                console.log('Quiz data loaded successfully!', quizData);
                // SUCCESS: This message indicates both file loading and database connection/query succeeded.
                if (quizContainer) {
                     quizContainer.innerHTML = `<p class="text-green-600 font-bold">SUCCESS! Loaded ${quizData.length} questions. Now insert quiz rendering logic.</p>`;
                }
            } else {
                // If the connection worked but data didn't return (Table empty or RLS is blocking)
                if (quizContainer) {
                    quizContainer.innerHTML = `<p class="error-message">No questions found. The table is empty or the **Row Level Security (RLS)** policy is blocking anonymous access.</p>`;
                }
            }
        }
        
    </script>
    
    <style>
        /* Basic styling is included here to ensure the page is readable */
        body { font-family: sans-serif; padding: 20px; background-color: #f8f8f8; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1a3e6a; border-bottom: 2px solid #1a3e6a; padding-bottom: 10px; margin-bottom: 20px; }
        .error-message { color: #dc2626; border: 1px solid #dc2626; padding: 15px; background: #fee2e2; border-radius: 4px; }
        .text-green-600 { color: #059669; }
        .font-bold { font-weight: 700; }
    </style>
</head>
<body>

    <div class="container">
        <h1>CBSE Class 11 Microeconomics: Demand Quiz</h1>
        
        <div id="quiz-container">
            <p>Loading quiz questions from Supabase...</p>
        </div>

        <div id="config-error" class="error-message" style="display:none;">
            Configuration Error üõë<br>Quiz failed to load because Supabase credentials are missing or the 'config.js' file could not be found.
        </div>
    </div>

</body>
</html>
