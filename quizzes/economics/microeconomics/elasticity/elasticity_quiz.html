function renderQuiz() {
    const container = document.getElementById('quiz-container');
    
    const displayDifficulty = QUIZ_DATA.difficulty.charAt(0).toUpperCase() + QUIZ_DATA.difficulty.slice(1);
    const titleDifficulty = displayDifficulty === 'Complex' ? 'Advanced' : displayDifficulty;

    let quizHtml = `<h2 class="text-3xl font-extrabold text-cbse-blue mb-6">${titleDifficulty} Quiz (${QUIZ_DATA.questions.length} Questions)</h2>`;
    
    QUIZ_DATA.questions.forEach((q, index) => {
        const questionNumber = index + 1;
        
        const rawQuestionText = q.question_text || '';
        const typeString = q.question_type ? q.question_type.toLowerCase() : '';
        
        // --- ASSERTION CHECK ---
        const isAssertionType = typeString.includes('a&r') || 
                                typeString.includes('ar') || 
                                typeString.includes('assertion');

        // --- QUESTION TEXT FIX (Removing Reason from the Question) ---
        let questionText; 
        if (isAssertionType) {
            // Split at the 'Reason (R):' marker (case-insensitive, handles various markdown)
            const assertionPart = rawQuestionText.split(/\*\*Reason \(R\):\*\*/i)[0];
            questionText = cleanText(assertionPart);
            
        } else {
            // For all other types (MCQ, Case), use the full text.
            questionText = cleanText(rawQuestionText);
        }
        
        // --- SCENARIO/REASON BLOCK LOGIC ---
        // Includes 'ar' for the robust type check fix
        const hasType = isAssertionType || 
                        typeString.includes('case'); 

        // Check for raw text content (not null, not an empty string, and not 'N/A')
        const hasRawText = q.scenario_reason_text && 
                           q.scenario_reason_text.trim() !== '' && 
                           q.scenario_reason_text.toUpperCase() !== 'N/A';
        
        const showScenario = hasType && hasRawText;

        // Clean the text only if we decided to display it
        const scenarioReasonText = showScenario ? cleanText(q.scenario_reason_text) : '';
        
        // =================================================================
        // ðŸš¨ TEMPORARY DEBUG LOG ðŸš¨ (KEEP THIS UNTIL YOU VERIFY THE FIX)
        console.log(`DEBUG Q${questionNumber}: Type: ${q.question_type} | isAssertionType: ${isAssertionType} | hasType: ${hasType} | Raw Data (scenario_reason_text): "${q.scenario_reason_text}" | hasRawText: ${hasRawText} | showScenario: ${showScenario}`);
        // =================================================================

        // --- OPTIONS LOGIC ---
        let options = [];

        // Check for A&R/Assertion types to determine option filtering (use ALL 4 for A&R)
        if (isAssertionType) {
            options = [
                { key: 'A', text: cleanText(q.option_a) },
                { key: 'B', text: cleanText(q.option_b) },
                { key: 'C', text: cleanText(q.option_c) },
                { key: 'D', text: cleanText(q.option_d) }
            ];
        } else {
            // For MCQ/Case, filter out empty options
            options = [
                { key: 'A', text: cleanText(q.option_a) },
                { key: 'B', text: cleanText(q.option_b) },
                { key: 'C', text: cleanText(q.option_c) },
                { key: 'D', text: cleanText(q.option_d) }
            ].filter(opt => opt.text !== null && opt.text.trim() !== '');
        }

        quizHtml += `
            <div id="q-card-${index}" class="question-card p-6 mb-6 bg-white border border-gray-200 rounded-lg shadow-sm">
                <p class="text-lg font-semibold text-gray-800 mb-3">${questionNumber}. ${questionText}</p>
                
                ${showScenario ? 
                    // This block displays the scenario/reason text (Only if showScenario is true)
                    `<div class="bg-gray-50 p-3 mb-4 shadow-inner border-l-4 border-cbse-blue">
                        <p class="text-base font-normal text-gray-800">
                            <span class="font-bold text-cbse-blue">Reason (R):</span> ${scenarioReasonText}
                        </p>
                    </div>` 
                    : ''}
                
                <div class="options space-y-2">
                    ${options.map(opt => `
                        <label class="block p-3 border border-gray-100 rounded-lg cursor-pointer hover:bg-cbse-light transition duration-150">
                            <input 
                                type="radio" 
                                name="q_${index}" 
                                value="${opt.key}" 
                                onchange="storeAnswer(${index}, this.value)"
                                class="mr-3 text-cbse-blue focus:ring-cbse-blue"
                            >
                            <span class="font-medium">${opt.key}.</span> ${opt.text}
                        </label>
                    `).join('')}
                </div>
            </div>
        `;
    });

    quizHtml += `
        <button 
            id="submit-button"
            class="w-full mt-8 px-8 py-3 text-lg bg-cbse-blue text-white font-bold rounded-lg shadow-xl hover:bg-blue-700 transition duration-150"
            onclick="submitQuiz()">
            Submit Answers
        </button>
        <button 
            class="w-full mt-4 text-sm text-gray-500 hover:text-cbse-blue transition duration-150"
            onclick="renderDifficultySelection(ALL_QUESTIONS.simple.concat(ALL_QUESTIONS.medium, ALL_QUESTIONS.complex))">
            Go Back to Difficulty Selection
        </button>
    `;

    container.innerHTML = quizHtml;
}
