<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Price Elasticity of Demand Chapter Quiz</title>
Â  Â  
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script>
Â  Â  Â  Â  tailwind.config = {
Â  Â  Â  Â  Â  Â  theme: {
Â  Â  Â  Â  Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sans: ['Inter', 'sans-serif'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'cbse-blue': '#1a3e6a', 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'cbse-light': '#f0f4f8', 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'accent-green': '#059669', 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'correct': '#10b981', /* Emerald 500 */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'incorrect': '#ef4444', /* Red 500 */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script> 

Â  Â  <script src="/eleventh-class/js/config.js"></script> 
</head>
<body class="bg-cbse-light min-h-screen antialiased">

Â  Â  <header class="bg-white shadow-lg sticky top-0 z-10 border-t-8 border-cbse-blue">
Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold text-cbse-blue">Price Elasticity of Demand Quiz Portal</h1>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
Â  Â  Â  Â  <div id="quiz-container" class="container bg-white p-6 md:p-10 rounded-xl shadow-lg">
Â  Â  Â  Â  Â  Â  <p class="text-cbse-blue font-semibold">Loading quiz modules...</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="config-error" class="hidden error-message mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
Â  Â  Â  Â  Â  Â  Configuration Error ðŸ›‘<br>Quiz failed to load because Supabase credentials are missing or the 'config.js' file could not be found.
Â  Â  Â  Â  </div>
Â  Â  </main>
Â  Â  
Â  Â  <script>
Â  Â  Â  Â  // Global variables to store filtered questions
Â  Â  Â  Â  let ALL_QUESTIONS = [];
Â  Â  Â  Â  let QUIZ_DATA = {};
Â  Â  Â  Â  const TARGET_QUESTION_COUNT = 20;
Â  Â  Â  Â  
Â  Â  Â  Â  // CRITICAL UPDATE: Changed table name to 'elasticity'
Â  Â  Â  Â  const TABLE_NAME = 'elasticity'; 

Â  Â  Â  Â  // Utility to shuffle and slice an array
Â  Â  Â  Â  function shuffleAndSlice(array, count) {
Â  Â  Â  Â  Â  Â  const shuffled = array.sort(() => 0.5 - Math.random());
Â  Â  Â  Â  Â  Â  return shuffled.slice(0, count);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Utility to clean up formatting from Supabase data fields
Â  Â  Â  Â  function cleanText(text) {
Â  Â  Â  Â  Â  Â  if (!text) return '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  let cleaned = text;

Â  Â  Â  Â  Â  Â  // ðŸš¨ FIX: Remove common redundant prefixes (Scenario/Case/Reason) from the start of the raw data.
Â  Â  Â  Â  Â  Â  // This prevents duplication when the script adds its own label.
Â  Â  Â  Â  Â  Â  cleaned = cleaned
Â  Â  Â  Â  Â  Â  Â  Â  // Regex matches optional ** bolding, then (Scenario|Case|Reason (R)):, then optional ** bolding.
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/^\s*\*\*?(Scenario|Case|Reason \(R\)):\*\*\s*/i, '')
Â  Â  Â  Â  Â  Â  Â  Â  .trim(); 

Â  Â  Â  Â  Â  Â  // 1. Convert LaTeX price/value notation and cleanup $ signs
Â  Â  Â  Â  Â  Â  cleaned = cleaned
Â  Â  Â  Â  Â  Â  Â  Â  // Convert double dollar signs ($$ ... $$) to HTML for math display
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\$\$(.*?)\$\$/g, '<span class="math-formula inline-block my-1 italic">$1</span>')
Â  Â  Â  Â  Â  Â  Â  Â  // Replace \text{...} with just the content
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\\text\{([^\}]+)\}/g, '$1')
Â  Â  Â  Â  Â  Â  Â  Â  // Replace \$ with the Rupee symbol
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\\\$/g, 'â‚¹')
Â  Â  Â  Â  Â  Â  Â  Â  // Replace \\ with a line break (often used for A&R)
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\\\\/g, '<br>')
Â  Â  Â  Â  Â  Â  Â  Â  // Remove left/right parentheses/braces used in LaTeX
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\\(left|right)[\(\)\|\{\}]/g, '')
Â  Â  Â  Â  Â  Â  Â  Â  // Remove any remaining stray single $ signs (must be last in this chain)
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\$/g, '');

Â  Â  Â  Â  Â  Â  // 2. Convert all other Markdown bolding to HTML strong (for both Q and Options)
Â  Â  Â  Â  Â  Â  cleaned = cleaned.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 3. Specific pattern fix for underlining (optional, based on your previous use)
Â  Â  Â  Â  Â  Â  cleaned = cleaned.replace(/a\s+\*+['"]?([^*'"]+)['"]?\*+\s+in/, 'a <u>$1</u> in');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return cleaned;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Core Quiz State Management ---

Â  Â  Â  Â  function renderDifficultySelection(fullData) {
Â  Â  Â  Â  Â  Â  // Standardize all difficulty labels to lowercase for robust filtering
Â  Â  Â  Â  Â  Â  const standardizedData = fullData.map(q => ({
Â  Â  Â  Â  Â  Â  Â  Â  ...q,
Â  Â  Â  Â  Â  Â  Â  Â  difficulty: q.difficulty ? q.difficulty.toLowerCase().trim() : 'medium'
Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  // Filter questions using standardized strings
Â  Â  Â  Â  Â  Â  const simpleQuestions = standardizedData.filter(q => q.difficulty.includes('simple') || q.difficulty.includes('easy'));
Â  Â  Â  Â  Â  Â  const mediumQuestions = standardizedData.filter(q => q.difficulty.includes('medium') || q.difficulty.includes('moderate'));
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Look for 'complex', 'advanced', 'advance', or 'high'
Â  Â  Â  Â  Â  Â  const complexQuestions = standardizedData.filter(q => 
Â  Â  Â  Â  Â  Â  Â  Â  q.difficulty.includes('complex') || 
Â  Â  Â  Â  Â  Â  Â  Â  q.difficulty.includes('advanced') || 
Â  Â  Â  Â  Â  Â  Â  Â  q.difficulty.includes('advance') ||
Â  Â  Â  Â  Â  Â  Â  Â  q.difficulty.includes('high')
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  ALL_QUESTIONS = {
Â  Â  Â  Â  Â  Â  Â  Â  simple: simpleQuestions,
Â  Â  Â  Â  Â  Â  Â  Â  medium: mediumQuestions,
Â  Â  Â  Â  Â  Â  Â  Â  complex: complexQuestions 
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const html = `
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold text-cbse-blue mb-8">Choose Your Difficulty Level</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createDifficultyCard('simple', simpleQuestions.length, 'Easy start, covers foundational concepts.', 'bg-accent-green hover:bg-green-700')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createDifficultyCard('medium', mediumQuestions.length, 'Moderate difficulty, requires application of concepts.', 'bg-yellow-600 hover:bg-yellow-700')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createDifficultyCard('complex', complexQuestions.length, 'High difficulty, includes numericals and critical analysis.', 'bg-red-600 hover:bg-red-700')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  document.getElementById('quiz-container').innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  function createDifficultyCard(level, count, description, colorClass) {
Â  Â  Â  Â  Â  Â  const actualCount = Math.min(count, TARGET_QUESTION_COUNT);
Â  Â  Â  Â  Â  Â  const buttonText = count >= TARGET_QUESTION_COUNT 
Â  Â  Â  Â  Â  Â  Â  Â  ? `Start Quiz (${TARGET_QUESTION_COUNT} Qs)` 
Â  Â  Â  Â  Â  Â  Â  Â  : `Start Quiz (${count} Qs)`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const displayName = level.charAt(0).toUpperCase() + level.slice(1);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 bg-cbse-light rounded-lg shadow-md border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-2xl font-bold capitalize text-cbse-blue mb-2">${displayName === 'Complex' ? 'Advanced' : displayName}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 text-sm mb-4">${description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold mb-4 text-gray-700">Available: ${count} questions. Starting: ${actualCount} questions.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-6 py-2 text-white font-bold rounded-lg shadow-md transition duration-150 ${colorClass}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="startQuiz('${level}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function startQuiz(difficulty) {
Â  Â  Â  Â  Â  Â  const allQs = ALL_QUESTIONS[difficulty];
Â  Â  Â  Â  Â  Â  QUIZ_DATA.questions = shuffleAndSlice(allQs, TARGET_QUESTION_COUNT);
Â  Â  Â  Â  Â  Â  QUIZ_DATA.difficulty = difficulty;
Â  Â  Â  Â  Â  Â  QUIZ_DATA.answers = {}; 

Â  Â  Â  Â  Â  Â  renderQuiz();
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function renderQuiz() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const displayDifficulty = QUIZ_DATA.difficulty.charAt(0).toUpperCase() + QUIZ_DATA.difficulty.slice(1);
Â  Â  Â  Â  Â  Â  const titleDifficulty = displayDifficulty === 'Complex' ? 'Advanced' : displayDifficulty;

Â  Â  Â  Â  Â  Â  let quizHtml = `<h2 class="text-3xl font-extrabold text-cbse-blue mb-6">${titleDifficulty} Quiz (${QUIZ_DATA.questions.length} Questions)</h2>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  QUIZ_DATA.questions.forEach((q, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const questionNumber = index + 1;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const rawQuestionText = q.question_text || '';
Â  Â  Â  Â  Â  Â  Â  Â  const typeString = q.question_type ? q.question_type.toLowerCase() : '';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // --- ASSERTION CHECK ---
Â  Â  Â  Â  Â  Â  Â  Â  const isAssertionType = typeString.includes('a&r') || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typeString.includes('ar') || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typeString.includes('assertion');

Â  Â  Â  Â  Â  Â  Â  Â  // --- QUESTION TEXT FIX (Removing Reason from the Question for AR) ---
Â  Â  Â  Â  Â  Â  Â  Â  let questionText; 
Â  Â  Â  Â  Â  Â  Â  Â  if (isAssertionType) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Split at the 'Reason (R):' marker to separate A and R 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const assertionPart = rawQuestionText.split(/\*\*Reason \(R\):\*\*/i)[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Clean the Assertion (A) part, which may contain a "Assertion:" prefix
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionText = cleanText(assertionPart); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // For all other types (MCQ, Case), use the full text and clean it
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionText = cleanText(rawQuestionText);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // --- SCENARIO/REASON BLOCK LOGIC ---
Â  Â  Â  Â  Â  Â  Â  Â  const hasType = isAssertionType || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typeString.includes('case'); 

Â  Â  Â  Â  Â  Â  Â  Â  const hasRawText = q.scenario_reason_text && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â q.scenario_reason_text.trim() !== '' && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â q.scenario_reason_text.toUpperCase() !== 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const showScenario = hasType && hasRawText;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Clean the scenario text (the cleanText function now handles removing the duplicate prefix)
Â  Â  Â  Â  Â  Â  Â  Â  const scenarioReasonText = showScenario ? cleanText(q.scenario_reason_text) : ''; 

Â  Â  Â  Â  Â  Â  Â  Â  // --- OPTIONS LOGIC ---
Â  Â  Â  Â  Â  Â  Â  Â  let options = [];

Â  Â  Â  Â  Â  Â  Â  Â  // Check for A&R/Assertion types to determine option filtering (use ALL 4 for A&R)
Â  Â  Â  Â  Â  Â  Â  Â  if (isAssertionType) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'A', text: cleanText(q.option_a) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'B', text: cleanText(q.option_b) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'C', text: cleanText(q.option_c) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'D', text: cleanText(q.option_d) }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // For MCQ/Case, filter out empty options
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'A', text: cleanText(q.option_a) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'B', text: cleanText(q.option_b) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'C', text: cleanText(q.option_c) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { key: 'D', text: cleanText(q.option_d) }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ].filter(opt => opt.text !== null && opt.text.trim() !== '');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  quizHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="q-card-${index}" class="question-card p-6 mb-6 bg-white border border-gray-200 rounded-lg shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-semibold text-gray-800 mb-3">${questionNumber}. ${questionText}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${showScenario && scenarioReasonText ? 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // This block displays the scenario/reason text (Only if showScenario is true AND the text is not empty after cleaning)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="bg-gray-50 p-3 mb-4 shadow-inner border-l-4 border-cbse-blue">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-base font-normal text-gray-800">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-cbse-blue">${isAssertionType ? 'Reason (R):' : 'Scenario:'}</span> ${scenarioReasonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>` 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="options space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${options.map(opt => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block p-3 border border-gray-100 rounded-lg cursor-pointer hover:bg-cbse-light transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="radio" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="q_${index}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value="${opt.key}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="storeAnswer(${index}, this.value)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="mr-3 text-cbse-blue focus:ring-cbse-blue"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-medium">${opt.key}.</span> ${opt.text}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  quizHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="submit-button"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full mt-8 px-8 py-3 text-lg bg-cbse-blue text-white font-bold rounded-lg shadow-xl hover:bg-blue-700 transition duration-150"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="submitQuiz()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Submit Answers
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full mt-4 text-sm text-gray-500 hover:text-cbse-blue transition duration-150"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="renderDifficultySelection(ALL_QUESTIONS.simple.concat(ALL_QUESTIONS.medium, ALL_QUESTIONS.complex))">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Go Back to Difficulty Selection
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  container.innerHTML = quizHtml;
Â  Â  Â  Â  }
Â  Â  Â  Â 
Â  Â  Â  Â  function storeAnswer(qIndex, answerKey) {
Â  Â  Â  Â  Â  Â  QUIZ_DATA.answers[qIndex] = answerKey;
Â  Â  Â  Â  }

Â  Â  Â  Â  function submitQuiz() {
Â  Â  Â  Â  Â  Â  const totalQuestions = QUIZ_DATA.questions.length;
Â  Â  Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  QUIZ_DATA.questions.forEach((q, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const userAnswer = QUIZ_DATA.answers[index];
Â  Â  Â  Â  Â  Â  Â  Â  const correctAnswer = q.correct_answer_key;
Â  Â  Â  Â  Â  Â  Â  Â  const questionCard = document.getElementById(`q-card-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Disable all radio buttons
Â  Â  Â  Â  Â  Â  Â  Â  const radios = questionCard.querySelectorAll(`input[name="q_${index}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  radios.forEach(radio => radio.disabled = true);

Â  Â  Â  Â  Â  Â  Â  Â  // Highlight results
Â  Â  Â  Â  Â  Â  Â  Â  if (userAnswer === correctAnswer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionCard.classList.add('border-correct', 'bg-green-50');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionCard.classList.add('border-incorrect', 'bg-red-50');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Show correct answer for every question
Â  Â  Â  Â  Â  Â  Â  Â  const optionsContainer = questionCard.querySelector('.options');
Â  Â  Â  Â  Â  Â  Â  Â  const options = optionsContainer.querySelectorAll('label');

Â  Â  Â  Â  Â  Â  Â  Â  options.forEach(label => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const input = label.querySelector('input');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const optionKey = input.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (optionKey === correctAnswer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Highlight the correct answer
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label.classList.add('bg-correct', 'text-white', 'font-bold');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label.classList.remove('hover:bg-cbse-light');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (optionKey === userAnswer && userAnswer !== correctAnswer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Highlight the user's incorrect choice
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label.classList.add('bg-incorrect', 'text-white', 'font-bold');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label.classList.remove('hover:bg-cbse-light');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Dim incorrect options that weren't selected
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label.classList.add('opacity-50');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Display final score
Â  Â  Â  Â  Â  Â  const scoreHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 md:p-10 mb-8 text-center bg-cbse-blue text-white rounded-lg shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-4xl font-extrabold mb-2">Quiz Complete!</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-6xl font-black">${score}/${totalQuestions}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-semibold mt-2">Your Score is: ${((score / totalQuestions) * 100).toFixed(1)}%</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  document.getElementById('quiz-container').insertAdjacentHTML('afterbegin', scoreHtml);
Â  Â  Â  Â  Â  Â  document.getElementById('submit-button').remove(); 

Â  Â  Â  Â  Â  Â  // Scroll to top to show score
Â  Â  Â  Â  Â  Â  document.getElementById('quiz-container').scrollIntoView({ behavior: 'smooth' });
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- Supabase Connection and Initialization ---

Â  Â  Â  Â  function initSupabase() {
Â  Â  Â  Â  Â  Â  const configError = document.getElementById('config-error');

Â  Â  Â  Â  Â  Â  if (typeof window.SUPABASE_URL === 'undefined' || typeof window.SUPABASE_ANON_KEY === 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  configError.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Configuration failed: Supabase keys are missing.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const supabaseClient = supabase.createClient(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.SUPABASE_URL,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.SUPABASE_ANON_KEY
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Supabase client initialized successfully. Attempting to fetch quiz data.");
Â  Â  Â  Â  Â  Â  Â  Â  fetchQuizData(supabaseClient); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function fetchQuizData(supabaseClient) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('quiz-container');

Â  Â  Â  Â  Â  Â  const { data: quizData, error } = await supabaseClient
Â  Â  Â  Â  Â  Â  Â  Â  .from(TABLE_NAME) // Uses the new 'elasticity' table
Â  Â  Â  Â  Â  Â  Â  Â  .select('*');

Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Supabase Query Error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  if (container) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="error-message text-red-700 bg-red-100 p-4 rounded">Error retrieving questions: ${error.message}. Please check RLS policy for the table **${TABLE_NAME}**.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (quizData && quizData.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`Quiz data loaded successfully! Array(${quizData.length})`, quizData);
Â  Â  Â  Â  Â  Â  Â  Â  renderDifficultySelection(quizData);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (container) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="text-gray-700 p-4 rounded">No questions found. The table **${TABLE_NAME}** is empty or the RLS policy is blocking access, but not giving a proper error code.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Start the application after the script loads
Â  Â  Â  Â  initSupabase();
Â  Â  </script>
</body>
</html>
